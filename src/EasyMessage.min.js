!function(){"strict";function t(t){if(this.event=t,this.valid=!1,"object"==typeof t&&t.data){var e=t.data;e.startsWith(o)&&(e=JSON.parse(e.slice(o.length)),this.type=e.type,this.target=e.target,this.source=e.source,this.content=e.content,this.valid=!0)}}function e(t,e){if(arguments.length<2)throw new Error("IllegalArgumentException: arguments must constain window and name");if("object"!=typeof t)throw new Error("IllegalArgumentException: first argument must be window object");if("string"!=typeof e)throw new Error("IllegalArgumentException: second argument must be the client name");this.win=t,this.name=e}function n(t){this.win=t||window,this.listens={},this.initListener()}function r(){var t=this;t.parent=n,t.parent(window.top),delete t.parent,t.targets={},t.listen(function(n,r){var i=r.getOriginalEvent().source;try{var o=new e(i,r.source);t.registryTarget(o),o.send({type:c.RESPONSE_REGISTRY})}catch(s){throw s}},c.REQUEST_REGISTRY),t.listen(function(e,n){t.send(n.content,n.target,n.source)},c.UNICAST_MESSAGE),t.listen(function(e,n){t.multicast(n.content,n.source)},c.MULTICAST_MESSAGE)}function i(t){var i=this;i.parent=n,i.parent(),delete i.parent;var o=window.top;try{o.serverState||(o.serverState=s,new r)}catch(E){}i.serverTarget=new e(o,a),i.name=t,i.listen(function(){i.regSuccess=!0},c.RESPONSE_REGISTRY),i.serverTarget.send({type:c.REQUEST_REGISTRY,source:t})}var o="[MESSAGE_PREFIX]",s="STATE_CREATED",a="TOP_WINDOW",c={REQUEST_REGISTRY:"REQREG",RESPONSE_REGISTRY:"RESREG",UNICAST_MESSAGE:"UNICASTMSG",MULTICAST_MESSAGE:"MULTICASTMSG",SEND_MESSAGE:"SENDMSG"};t.prototype.isValid=function(){return this.valid},t.prototype.getOriginalEvent=function(){return this.event},e.prototype.send=function(t){this.win.postMessage(o+JSON.stringify(t),"*")},e.prototype.isClosed=function(){return this.win.closed},n.prototype.initListener=function(){var e=this,n=function(n){var r=new t(n);if(r.isValid()){var i=r.type,o=e.listens[i];if(o)for(var s=0;s<o.length;s++)o[s](r.content,r)}};"addEventListener"in document?e.win.addEventListener("message",n,!1):"attachEvent"in document&&e.win.attachEvent("onmessage",n)},n.prototype.listen=function(t,e){var e=e||c.SEND_MESSAGE,n=this.listens;n[e]?n[e].push(t):n[e]=[t]},n.prototype.clear=function(){this.listens={}},r.prototype=new n,r.prototype.multicast=function(t,e){var n=this.targets;for(var r in n){var i=n[r];if(i)for(var o=0,s=i.length;s>o;o++){var a=i[o];a.isClosed()?console&&console.log&&console.log("Target["+a.name+"] is left!"):a.send({type:c.SEND_MESSAGE,target:r,source:e,content:t})}}},r.prototype.send=function(t,e,n){var r=this.targets;if(r.hasOwnProperty(e)){var i=r[e];if(i)for(var o=0,s=i.length;s>o;o++){var a=i[o];a.isClosed()?console&&console.log&&console.log("Target["+a.name+"] is left!"):a.send({type:c.SEND_MESSAGE,target:e,source:n,content:t})}}},r.prototype.registryTarget=function(t){var e=this.targets,n=e[t.name];n||(n=e[t.name]=[]),n.push(t)},i.prototype=new n,i.prototype.send=function(t,e,n){var r=this,n=n||c.UNICAST_MESSAGE;if(!r.regSuccess)throw new Error("Registry Failure...");r.serverTarget.send({type:n,target:t,source:r.name,content:e})},i.prototype.multicast=function(t){this.send("",t,c.MULTICAST_MESSAGE)},window.MessageClient=i}();